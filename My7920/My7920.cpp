#include "My7920.h"

#define __MAX_STR				21

#define __HEIGHT				64 // Высота экрана
#define __WIDTH					128 // Высота экрана
#define	__WIDTH_BYTES			(__WIDTH>>3)
#define __SCREEN_BUFF_SIZE		(__HEIGHT * __WIDTH_BYTES)

// Standard ASCII 6x8 font
static const unsigned char __font6x8[] = {
//
_X_X____,
________,
XXXXX___,
X_______,
XXXX____,
X_______,
XXXXX___,
________,
_X_X____,
//
________,
_XXX____,
X___X___,
XXXXX___,
X_______,
_XXX____,
________,
//
X_______,
XXX_____,
XXXX____,
XXXXXX__,
XXXX____,
XXX_____,
X_______,
________,
// 0x20
________,
________,
________,
________,
________,
________,
________,
________,
// 0x21
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
________,
__X_____,
________,
// 0x22
_X__X___,
_X__X___,
_X__X___,
________,
________,
________,
________,
________,
// 0x23
_X_X____,
_X_X____,
XXXXX___,
_X_X____,
XXXXX___,
_X_X____,
_X_X____,
________,
// 0x24
__X_____,
_XXXX___,
X_X_____,
_XXX____,
__X_X___,
XXXX____,
__X_____,
________,
// 0x25
XX______,
XX__X___,
___X____,
__X_____,
_X______,
X__XX___,
___XX___,
________,
// 0x26
_XX_____,
X__X____,
X_X_____,
_X______,
X_X_X___,
X__X____,
_XX_X___,
________,
// 0x27
_XX_____,
__X_____,
_X______,
________,
________,
________,
________,
________,
// 0x28
___X____,
__X_____,
_X______,
_X______,
_X______,
__X_____,
___X____,
________,
// 0x29
_X______,
__X_____,
___X____,
___X____,
___X____,
__X_____,
_X______,
________,
// 0x2A
________,
_X_X____,
__X_____,
XXXXX___,
__X_____,
_X_X____,
________,
________,
// 0x2B
________,
__X_____,
__X_____,
XXXXX___,
__X_____,
__X_____,
________,
________,
// 0x2C
________,
________,
________,
________,
________,
_XX_____,
__X_____,
_X______,
// 0x2D
________,
________,
________,
XXXXX___,
________,
________,
________,
________,
// 0x2E
________,
________,
________,
________,
________,
_XX_____,
_XX_____,
________,
// 0x2F
________,
____X___,
___X____,
__X_____,
_X______,
X_______,
________,
________,
// 0x30
_XXX____,
X___X___,
X__XX___,
X_X_X___,
XX__X___,
X___X___,
_XXX____,
________,
// 0x31
__X_____,
_XX_____,
__X_____,
__X_____,
__X_____,
__X_____,
_XXX____,
________,
// 0x32
_XXX____,
X___X___,
____X___,
__XX____,
_X______,
X_______,
XXXXX___,
________,
// 0x33
_XXX____,
X___X___,
____X___,
__XX____,
____X___,
X___X___,
_XXX____,
________,
// 0x34
___X____,
__XX____,
_X_X____,
X__X____,
XXXXX___,
___X____,
___X____,
________,
// 0x35
XXXXX___,
X_______,
XXXX____,
____X___,
____X___,
X___X___,
_XXX____,
________,
// 0x36
__XX____,
_X______,
X_______,
XXXX____,
X___X___,
X___X___,
_XXX____,
________,
// 0x37
XXXXX___,
____X___,
___X____,
__X_____,
_X______,
_X______,
_X______,
________,
// 0x38
_XXX____,
X___X___,
X___X___,
_XXX____,
X___X___,
X___X___,
_XXX____,
________,
// 0x39
_XXX____,
X___X___,
X___X___,
_XXXX___,
____X___,
___X____,
_XX_____,
________,
// 0x3A
________,
_XX_____,
_XX_____,
________,
_XX_____,
_XX_____,
________,
________,
// 0x3B
________,
________,
_XX_____,
_XX_____,
________,
_XX_____,
__X_____,
_X______,
// 0x3C
___X____,
__X_____,
_X______,
X_______,
_X______,
__X_____,
___X____,
________,
// 0x3D
________,
________,
XXXXX___,
________,
XXXXX___,
________,
________,
________,
// 0x3E
X_______,
_X______,
__X_____,
___X____,
__X_____,
_X______,
X_______,
________,
// 0x3F
_XXX____,
X___X___,
____X___,
___X____,
__X_____,
________,
__X_____,
________,
// 0x40
_XXX____,
X___X___,
____X___,
_XX_X___,
X_X_X___,
X_X_X___,
_XXX____,
________,
// 0x41
_XXX____,
X___X___,
X___X___,
XXXXX___,
X___X___,
X___X___,
X___X___,
________,
// 0x42
XXXX____,
X___X___,
X___X___,
XXXX____,
X___X___,
X___X___,
XXXX____,
________,
// 0x43
_XXX____,
X___X___,
X_______,
X_______,
X_______,
X___X___,
_XXX____,
________,
// 0x44
XXX_____,
X__X____,
X___X___,
X___X___,
X___X___,
X__X____,
XXX_____,
________,
// 0x45
XXXXX___,
X_______,
X_______,
XXXX____,
X_______,
X_______,
XXXXX___,
________,
// 0x46
XXXXX___,
X_______,
X_______,
XXXX____,
X_______,
X_______,
X_______,
________,
// 0x47
_XXX____,
X___X___,
X_______,
X_______,
X__XX___,
X___X___,
_XXXX___,
________,
// 0x48
X___X___,
X___X___,
X___X___,
XXXXX___,
X___X___,
X___X___,
X___X___,
________,
// 0x49
_XXX____,
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
_XXX____,
________,
// 0x4A
__XXX___,
___X____,
___X____,
___X____,
___X____,
X__X____,
_XX_____,
________,
// 0x4B
X___X___,
X__X____,
X_X_____,
XX______,
X_X_____,
X__X____,
X___X___,
________,
// 0x4C
X_______,
X_______,
X_______,
X_______,
X_______,
X_______,
XXXXX___,
________,
// 0x4D
X___X___,
XX_XX___,
X_X_X___,
X_X_X___,
X___X___,
X___X___,
X___X___,
________,
// 0x4E
X___X___,
X___X___,
XX__X___,
X_X_X___,
X__XX___,
X___X___,
X___X___,
________,
// 0x4F
_XXX____,
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
_XXX____,
________,
// 0x50
XXXX____,
X___X___,
X___X___,
XXXX____,
X_______,
X_______,
X_______,
________,
// 0x51
_XXX____,
X___X___,
X___X___,
X___X___,
X_X_X___,
X__X____,
_XX_X___,
________,
// 0x52
XXXX____,
X___X___,
X___X___,
XXXX____,
X_X_____,
X__X____,
X___X___,
________,
// 0x53
_XXX____,
X___X___,
X_______,
_XXX____,
____X___,
X___X___,
_XXX____,
________,
// 0x54
XXXXX___,
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
________,
// 0x55
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
_XXX____,
________,
// 0x56
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
_X_X____,
__X_____,
________,
// 0x57
X___X___,
X___X___,
X___X___,
X_X_X___,
X_X_X___,
X_X_X___,
_X_X____,
________,
// 0x58
X___X___,
X___X___,
_X_X____,
__X_____,
_X_X____,
X___X___,
X___X___,
________,
// 0x59
X___X___,
X___X___,
X___X___,
_X_X____,
__X_____,
__X_____,
__X_____,
________,
// 0x5A
XXXXX___,
____X___,
___X____,
__X_____,
_X______,
X_______,
XXXXX___,
________,
// 0x5B
_XXX____,
_X______,
_X______,
_X______,
_X______,
_X______,
_XXX____,
________,
// 0x5C
________,
X_______,
_X______,
__X_____,
___X____,
____X___,
________,
________,
// 0x5D
_XXX____,
___X____,
___X____,
___X____,
___X____,
___X____,
_XXX____,
________,
// 0x5E
__X_____,
_X_X____,
X___X___,
________,
________,
________,
________,
________,
// 0x5F
________,
________,
________,
________,
________,
________,
________,
XXXXX___,
// 0x60
_X______,
__X_____,
___X____,
________,
________,
________,
________,
________,
// 0x61
________,
________,
_XXX____,
____X___,
_XXXX___,
X___X___,
_XXXX___,
________,
// 0x62
X_______,
X_______,
X_XX____,
XX__X___,
X___X___,
X___X___,
XXXX____,
________,
// 0x63
________,
________,
_XXX____,
X_______,
X_______,
X___X___,
_XXX____,
________,
// 0x64
____X___,
____X___,
_XX_X___,
X__XX___,
X___X___,
X___X___,
_XXXX___,
________,
// 0x65
________,
________,
_XXX____,
X___X___,
XXXXX___,
X_______,
_XXX____,
________,
// 0x66
__XX____,
_X__X___,
_X______,
XXX_____,
_X______,
_X______,
_X______,
________,
// 0x67
________,
________,
_XXXX___,
X___X___,
X___X___,
_XXXX___,
____X___,
_XXX____,
// 0x68
X_______,
X_______,
X_XX____,
XX__X___,
X___X___,
X___X___,
X___X___,
________,
// 0x69
__X_____,
________,
_XX_____,
__X_____,
__X_____,
__X_____,
_XXX____,
________,
// 0x6A
___X____,
________,
__XX____,
___X____,
___X____,
___X____,
X__X____,
_XX_____,
// 0x6B
X_______,
X_______,
X__X____,
X_X_____,
XX______,
X_X_____,
X__X____,
________,
// 0x6C
_XX_____,
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
_XXX____,
________,
// 0x6D
________,
________,
XX_X____,
X_X_X___,
X___X___,
X___X___,
X___X___,
________,
// 0x6E
________,
________,
X_XX____,
XX__X___,
X___X___,
X___X___,
X___X___,
________,
// 0x6F
________,
________,
_XXX____,
X___X___,
X___X___,
X___X___,
_XXX____,
________,
// 0x70
________,
________,
XXXX____,
X___X___,
X___X___,
XXXX____,
X_______,
X_______,
// 0x71
________,
________,
_XXXX___,
X___X___,
X___X___,
_XXXX___,
____X___,
____X___,
// 0x72
________,
________,
X_XX____,
XX__X___,
X_______,
X_______,
X_______,
________,
// 0x73
________,
________,
_XXXX___,
X_______,
_XXX____,
____X___,
XXXX____,
________,
// 0x74
_X______,
_X______,
XXX_____,
_X______,
_X______,
_X__X___,
__XX____,
________,
// 0x75
________,
________,
X___X___,
X___X___,
X___X___,
X__XX___,
_XX_X___,
________,
// 0x76
________,
________,
X___X___,
X___X___,
X___X___,
_X_X____,
__X_____,
________,
// 0x77
________,
________,
X___X___,
X___X___,
X_X_X___,
X_X_X___,
_X_X____,
________,
// 0x78
________,
________,
X___X___,
_X_X____,
__X_____,
_X_X____,
X___X___,
________,
// 0x79
________,
________,
X___X___,
X___X___,
X___X___,
_XXXX___,
____X___,
_XXX____,
// 0x7A
________,
________,
XXXXX___,
___X____,
__X_____,
_X______,
XXXXX___,
________,
// 0x7B
___X____,
__X_____,
__X_____,
_X______,
__X_____,
__X_____,
___X____,
________,
// 0x7C
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
________,
// 0x7D
_X______,
__X_____,
__X_____,
___X____,
__X_____,
__X_____,
_X______,
________,
// 0x7E
_XX_X___,
X__X____,
________,
________,
________,
________,
________,
________,
// 0x7F *********************
/*
________,
________,
________,
________,
________,
________,
________,
________,
// 0x80
________,
________,
________,
________,
________,
________,
________,
________,
// 0x81
________,
________,
________,
________,
________,
________,
________,
________,
// 0x82
________,
________,
________,
________,
________,
________,
________,
________,
// 0x83
________,
________,
________,
________,
________,
________,
________,
________,
// 0x84
________,
________,
________,
________,
________,
________,
________,
________,
// 0x85
________,
________,
________,
________,
________,
________,
________,
________,
// 0x86
________,
________,
________,
________,
________,
________,
________,
________,
// 0x87
________,
________,
________,
________,
________,
________,
________,
________,
// 0x88
________,
________,
________,
________,
________,
________,
________,
________,
// 0x89
________,
________,
________,
________,
________,
________,
________,
________,
// 0x8A
________,
________,
________,
________,
________,
________,
________,
________,
// 0x8B
________,
________,
________,
________,
________,
________,
________,
________,
// 0x8C
________,
________,
________,
________,
________,
________,
________,
________,
// 0x8D
________,
________,
________,
________,
________,
________,
________,
________,
// 0x8E
________,
________,
________,
________,
________,
________,
________,
________,
// 0x8F
________,
________,
________,
________,
________,
________,
________,
________,
// 0x90
________,
________,
________,
________,
________,
________,
________,
________,
// 0x91
________,
________,
________,
________,
________,
________,
________,
________,
// 0x92
________,
________,
________,
________,
________,
________,
________,
________,
// 0x93
________,
________,
________,
________,
________,
________,
________,
________,
// 0x94
________,
________,
________,
________,
________,
________,
________,
________,
// 0x95
________,
________,
________,
________,
________,
________,
________,
________,
// 0x96
________,
________,
________,
________,
________,
________,
________,
________,
// 0x97
________,
________,
________,
________,
________,
________,
________,
________,
// 0x98
________,
________,
________,
________,
________,
________,
________,
________,
// 0x99
________,
________,
________,
________,
________,
________,
________,
________,
// 0x9A
________,
________,
________,
________,
________,
________,
________,
________,
// 0x9B
________,
________,
________,
________,
________,
________,
________,
________,
// 0x9C
________,
________,
________,
________,
________,
________,
________,
________,
// 0x9D
________,
________,
________,
________,
________,
________,
________,
________,
// 0x9E
________,
________,
________,
________,
________,
________,
________,
________,
// 0x9F
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA0
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA1
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA2
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA3
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA4
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA5
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA6
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA7
________,
________,
________,
________,
________,
________,
________,
________,
// 0xA8
_X_X____,
________,
XXXXX___,
X_______,
XXXX____,
X_______,
XXXXX___,
________,
// 0xA9
________,
________,
________,
________,
________,
________,
________,
________,
// 0xAA
________,
________,
________,
________,
________,
________,
________,
________,
// 0xAB
________,
________,
________,
________,
________,
________,
________,
________,
// 0xAC
________,
________,
________,
________,
________,
________,
________,
________,
// 0xAD
________,
________,
________,
________,
________,
________,
________,
________,
// 0xAE
________,
________,
________,
________,
________,
________,
________,
________,
// 0xAF
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB0
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB1
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB2
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB3
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB4
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB5
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB6
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB7
________,
________,
________,
________,
________,
________,
________,
________,
// 0xB8
_X_X____,
________,
_XXX____,
X___X___,
XXXXX___,
X_______,
_XXX____,
________,
// 0xB9
________,
________,
________,
________,
________,
________,
________,
________,
// 0xBA
________,
________,
________,
________,
________,
________,
________,
________,
// 0xBB
________,
________,
________,
________,
________,
________,
________,
________,
// 0xBC
________,
________,
________,
________,
________,
________,
________,
________,
// 0xBD
________,
________,
________,
________,
________,
________,
________,
________,
// 0xBE
________,
________,
________,
________,
________,
________,
________,
________,
// 0xBF
________,
________,
________,
________,
________,
________,
________,
________,
*/
// 0xC0
_XXX____,
X___X___,
X___X___,
XXXXX___,
X___X___,
X___X___,
X___X___,
________,
// 0xC1
XXXXX___,
X_______,
X_______,
XXXX____,
X___X___,
X___X___,
XXXX____,
________,
// 0xC2
XXXX____,
X___X___,
X___X___,
XXXX____,
X___X___,
X___X___,
XXXX____,
________,
// 0xC3
XXXXX___,
X_______,
X_______,
X_______,
X_______,
X_______,
X_______,
________,
// 0xC4
__XX____,
_X_X____,
_X_X____,
_X_X____,
_X_X____,
XXXXX___,
X___X___,
________,
// 0xC5
XXXXX___,
X_______,
X_______,
XXXX____,
X_______,
X_______,
XXXXX___,
________,
// 0xC6
X_X_X___,
X_X_X___,
X_X_X___,
_XXX____,
X_X_X___,
X_X_X___,
X_X_X___,
________,
// 0xC7
_XXX____,
X___X___,
____X___,
___X____,
____X___,
X___X___,
_XXX____,
________,
// 0xC8
X___X___,
X___X___,
X__XX___,
X_X_X___,
XX__X___,
X___X___,
X___X___,
________,
// 0xC9
X_X_X___,
X___X___,
X__XX___,
X_X_X___,
XX__X___,
X___X___,
X___X___,
________,
// 0xCA
X___X___,
X___X___,
X__X____,
XXX_____,
X__X____,
X___X___,
X___X___,
________,
// 0xCB
__XXX___,
_X__X___,
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
________,
// 0xCC
X___X___,
XX_XX___,
XX_XX___,
X_X_X___,
X_X_X___,
X___X___,
X___X___,
________,
// 0xCD
X___X___,
X___X___,
X___X___,
XXXXX___,
X___X___,
X___X___,
X___X___,
________,
// 0xCE
_XXX____,
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
_XXX____,
________,
// 0xCF
XXXXX___,
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
________,
// 0xD0
XXXX____,
X___X___,
X___X___,
X___X___,
XXXX____,
X_______,
X_______,
________,
// 0xD1
_XXX____,
X___X___,
X_______,
X_______,
X_______,
X___X___,
_XXX____,
________,
// 0xD2
XXXXX___,
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
__X_____,
________,
// 0xD3
X___X___,
X___X___,
X___X___,
X___X___,
_XXXX___,
____X___,
XXXX____,
________,
// 0xD4
_XXX____,
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
_XXX____,
__X_____,
________,
// 0xD5
X___X___,
X___X___,
_X_X____,
__X_____,
_X_X____,
X___X___,
X___X___,
________,
// 0xD6
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
X___X___,
XXXXX___,
____X___,
// 0xD7
X___X___,
X___X___,
X___X___,
X___X___,
XXXXX___,
____X___,
____X___,
________,
// 0xD8
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
XXXXX___,
________,
// 0xD9
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
XXXXX___,
____X___,
// 0xDA
XX______,
_X______,
_X______,
_XXX____,
_X__X___,
_X__X___,
_XXX____,
________,
// 0xDB
X___X___,
X___X___,
X___X___,
XX__X___,
X_X_X___,
X_X_X___,
XX__X___,
________,
// 0xDC
_X______,
_X______,
_X______,
_XXX____,
_X__X___,
_X__X___,
_XXX____,
________,
// 0xDD
_XXX____,
X___X___,
____X___,
__XXX___,
____X___,
X___X___,
_XXX____,
________,
// 0xDE
X__X____,
X_X_X___,
X_X_X___,
XXX_X___,
X_X_X___,
X_X_X___,
X__X____,
________,
// 0xDF
_XXXX___,
X___X___,
X___X___,
X___X___,
_XXXX___,
_X__X___,
X___X___,
________,
// 0xE0
________,
________,
_XXX____,
____X___,
_XXXX___,
X___X___,
_XXXX___,
________,
// 0xE1
___XX___,
_XX_____,
X_______,
XXXX____,
X___X___,
X___X___,
_XXX____,
________,
// 0xE2
________,
________,
XXXX____,
X___X___,
XXXX____,
X___X___,
XXXX____,
________,
// 0xE3
________,
________,
XXXXX___,
X_______,
X_______,
X_______,
X_______,
________,
// 0xE4
________,
________,
__XX____,
_X_X____,
_X_X____,
XXXXX___,
X___X___,
________,
// 0xE5
________,
________,
_XXX____,
X___X___,
XXXXX___,
X_______,
_XXX____,
________,
// 0xE6
________,
________,
X_X_X___,
X_X_X___,
_XXX____,
X_X_X___,
X_X_X___,
________,
// 0xE7
________,
________,
_XXX____,
X___X___,
___X____,
X___X___,
_XXX____,
________,
// 0xE8
________,
________,
X___X___,
X__XX___,
X_X_X___,
XX__X___,
X___X___,
________,
// 0xE9
_XXX____,
________,
X___X___,
X__XX___,
X_X_X___,
XX__X___,
X___X___,
________,
// 0xEA
________,
________,
X___X___,
X__X____,
XXX_____,
X__X____,
X___X___,
________,
// 0xEB
________,
________,
__XXX___,
_X__X___,
X___X___,
X___X___,
X___X___,
________,
// 0xEC
________,
________,
X___X___,
XX_XX___,
X_X_X___,
X___X___,
X___X___,
________,
// 0xED
________,
________,
X___X___,
X___X___,
XXXXX___,
X___X___,
X___X___,
________,
// 0xEE
________,
________,
_XXX____,
X___X___,
X___X___,
X___X___,
_XXX____,
________,
// 0xEF
________,
________,
XXXXX___,
X___X___,
X___X___,
X___X___,
X___X___,
________,
// 0xF0
________,
________,
XXXX____,
X___X___,
XXXX____,
X_______,
X_______,
________,
// 0xF1
________,
________,
_XXX____,
X___X___,
X_______,
X___X___,
_XXX____,
________,
// 0xF2
________,
________,
XXXXX___,
__X_____,
__X_____,
__X_____,
__X_____,
________,
// 0xF3
________,
________,
X___X___,
X___X___,
_XXXX___,
____X___,
XXXX____,
________,
// 0xF4
________,
________,
_XXX____,
X_X_X___,
X_X_X___,
_XXX____,
__X_____,
________,
// 0xF5
________,
________,
X___X___,
_X_X____,
__X_____,
_X_X____,
X___X___,
________,
// 0xF6
________,
________,
X___X___,
X___X___,
X___X___,
X___X___,
XXXXX___,
____X___,
// 0xF7
________,
________,
X___X___,
X___X___,
XXXXX___,
____X___,
____X___,
________,
// 0xF8
________,
________,
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
XXXXX___,
________,
// 0xF9
________,
________,
X_X_X___,
X_X_X___,
X_X_X___,
X_X_X___,
XXXXX___,
____X___,
// 0xFA
________,
________,
XX______,
_X______,
_XXX____,
_X__X___,
_XXX____,
________,
// 0xFB
________,
________,
X___X___,
X___X___,
XX__X___,
X_X_X___,
XX__X___,
________,
// 0xFC
________,
________,
_X______,
_X______,
_XXX____,
_X__X___,
_XXX____,
________,
// 0xFD
________,
________,
_XXX____,
X___X___,
__XXX___,
X___X___,
_XXX____,
________,
// 0xFE
________,
________,
X__X____,
X_X_X___,
XXX_X___,
X_X_X___,
X__X____,
________,
// 0xFF
________,
________,
_XXXX___,
X___X___,
_XXXX___,
_X__X___,
X___X___,
________
};

uint8_t __frame_buff[__SCREEN_BUFF_SIZE+4];

uint8_t * get_1024_ptr(void) { return __frame_buff; }

static void __SPI_INIT(void) {
	pinMode(SCLKpin, OUTPUT);
	pinMode(MOSIpin, OUTPUT);
}

static void __SEND_BYTE(uint8_t val) {
	for (uint8_t i=0; i<8; i++) {
		digitalWrite(SCLKpin, LOW);
		//delayMicroseconds(1);
		digitalWrite(MOSIpin, val&0x80);
		val <<= 1;
		//delayMicroseconds(1);
		digitalWrite(SCLKpin, HIGH);
	}
}

static void __SET_CMD(void) {
	__SEND_BYTE(0xf8); delayMicroseconds(10);
};

static void __SET_DAT(void) {
	__SEND_BYTE(0xfa); delayMicroseconds(10);
}

static void __WRITE_BYTE(uint8_t b) {
	__SEND_BYTE(b & 0xF0); __SEND_BYTE(b << 4);
}

void My7920SetXY(uint8_t x16, uint8_t y) {
	__SET_CMD();
	if (y < 32) {
		__WRITE_BYTE(0x80 | y);
		__WRITE_BYTE(0x80 | x16);
	}
	else {
		__WRITE_BYTE(0x80 | (y-32));
		__WRITE_BYTE(0x80 | (x16+8));
	}
	__SET_DAT();
}

void My7920Update(void) {
	uint8_t * ptr = __frame_buff;
	uint8_t * pp;
	for (uint8_t yi=0; yi<__HEIGHT; yi++) {
		My7920SetXY(0, yi);
		pp = ptr;
		for (uint8_t xi=0; xi<__WIDTH_BYTES; xi++) { __WRITE_BYTE(*pp++); }
		ptr += __WIDTH_BYTES;
	}
}

void My7920Clear(void) {
	memset(__frame_buff, 0, sizeof(__frame_buff));
}

static void __init(void) {
	__SPI_INIT();
	delay(120);				//initial delay for boot up
	__SET_CMD();
	__WRITE_BYTE(0x08);		//display off, cursor+blink off
	__WRITE_BYTE(0x01);		//clear CGRAM ram
	delay(15);				//delay for CGRAM clear
	__WRITE_BYTE(0x3E);		//extended mode + GDRAM active
	__WRITE_BYTE(0x0C);		//display on, cursor+blink off
}

void My7920Init(void) {
	__init();
	delay(50);
	__init();
	My7920Clear();
	My7920Update();
}

void My7920HLine(uint8_t y, uint8_t pattern) {
	memset(&__frame_buff[y*__WIDTH_BYTES], pattern, __WIDTH_BYTES);
}

/*
static void my_cpy(uint8_t * dst, const uint8_t * src, uint16_t len) {
	while (len--) { *dst++ = *src++; }
}
*/

void My7920DrawImg(const uint8_t * ptr, uint8_t x8, uint8_t y, uint8_t wx8, uint8_t wy) { // x кратно 8
	uint8_t *fbp = &__frame_buff[y * __WIDTH_BYTES + x8];
	for (uint8_t yi=0; yi<wy; yi++) {
		memcpy(fbp, ptr, wx8);
		//my_cpy(fbp, ptr, wx8);
		ptr += wx8;
		fbp += __WIDTH_BYTES;
	}
}

static uint8_t __map_ch(uint8_t ch) {
	if (ch=='Ё') return 0;
	if (ch=='ё') return 1;
	if (ch>=0xC0) return ch - 0xC0 + 0x7F - (0x20-3);
	else return ch - (0x20-3);
}

void My7920Write(uint8_t ch, uint8_t x, uint8_t y) {
	uint8_t * font_ptr = (uint8_t *)&__font6x8[__map_ch(ch)<<3];
	uint8_t * scr_ptr = &__frame_buff[(x>>3) + (uint16_t)y * __WIDTH_BYTES];
	x &= 0x07; // x как смещение в байте
	for (uint8_t yi=0; yi<8; yi++) {
		uint8_t bb = *font_ptr++;
		uint8_t sb = *scr_ptr;
		sb &= ~(0xFC >> x);
		sb |= bb >> x;
		*scr_ptr++ = sb;
		sb = *scr_ptr;
		sb &= ~(0xFC << (8 - x));
		sb |= bb << (8 - x);
		*scr_ptr = sb;
		scr_ptr += __WIDTH_BYTES - 1;
	}
}

void My7920Print(const uint8_t * str, uint8_t x, uint8_t y) {
	uint8_t l = __MAX_STR;
	while(*str && l--) {
		My7920Write(*str++, x, y);
		x += 6;
	}
}

void My7920Text(const uint8_t * str, uint8_t start_string) {
	uint8_t ch, x=0, y=0;
	My7920Clear();
	while (start_string) {
		if (*str == '\n') { start_string--; }
		str++;
	}
	while ((ch = *str++) != 0 && y < (__HEIGHT)) {
		if (ch == '\n') { x=0; y += 8; }
		else { My7920Write(ch, x, y); x += 6; }
	}
	My7920Update();
}
